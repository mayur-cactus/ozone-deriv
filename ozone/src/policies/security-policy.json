{
  "version": "1.0",
  "policy_name": "AI WAF Security Policy",
  "description": "Comprehensive security policy for LLM/Agent protection",
  "last_updated": "2026-02-07",
  
  "allowed_domains": [
    "product FAQ",
    "general knowledge",
    "technical support",
    "documentation assistance",
    "code help"
  ],
  
  "denied_topics": [
    "prompt injection",
    "jailbreak attempts",
    "system manipulation",
    "data exfiltration",
    "credential theft"
  ],
  
  "forbidden_patterns": {
    "description": "Regex and text patterns that indicate malicious intent",
    "patterns": [
      {
        "pattern": "ignore all previous instructions",
        "severity": "high",
        "action": "block",
        "description": "Direct prompt injection"
      },
      {
        "pattern": "ignore previous instructions",
        "severity": "high",
        "action": "block",
        "description": "Prompt injection variant"
      },
      {
        "pattern": "reveal (your )?system prompt",
        "severity": "high",
        "action": "block",
        "description": "System prompt extraction attempt"
      },
      {
        "pattern": "bypass (your )?guardrails",
        "severity": "high",
        "action": "block",
        "description": "Security bypass attempt"
      },
      {
        "pattern": "you are now (in )?developer mode",
        "severity": "high",
        "action": "block",
        "description": "Jailbreak attempt"
      },
      {
        "pattern": "act as DAN",
        "severity": "high",
        "action": "block",
        "description": "DAN (Do Anything Now) jailbreak"
      },
      {
        "pattern": "pretend you (have|are) no restrictions",
        "severity": "high",
        "action": "block",
        "description": "Constraint removal attempt"
      },
      {
        "pattern": "forget (everything|all instructions)",
        "severity": "medium",
        "action": "block",
        "description": "Instruction override"
      }
    ]
  },
  
  "risk_scoring": {
    "description": "Risk score calculation thresholds",
    "thresholds": {
      "low": {
        "min": 0,
        "max": 30,
        "action": "allow"
      },
      "medium": {
        "min": 31,
        "max": 69,
        "action": "allow_with_monitoring"
      },
      "high": {
        "min": 70,
        "max": 100,
        "action": "block"
      }
    },
    "factors": {
      "forbidden_pattern_match": 85,
      "semantic_classifier_high": 75,
      "multiple_suspicious_signals": 65,
      "tool_policy_violation": 80,
      "pii_in_output": 60
    }
  },
  
  "tool_policies": {
    "description": "Policies for tool/function calling",
    "allowed_tools": [
      "search",
      "calculator",
      "summarize",
      "translate",
      "weather",
      "calendar_view"
    ],
    "restricted_tools": {
      "transfer_money": {
        "requires_approval": true,
        "max_amount": 1000,
        "allowed_roles": ["admin", "finance"],
        "audit_required": true
      },
      "send_email": {
        "requires_approval": true,
        "max_recipients": 10,
        "allowed_domains": ["company.com"],
        "audit_required": true
      },
      "delete_data": {
        "requires_approval": true,
        "allowed_roles": ["admin"],
        "audit_required": true
      },
      "execute_code": {
        "requires_approval": true,
        "allowed_roles": ["developer"],
        "sandboxed": true,
        "audit_required": true
      }
    },
    "denied_tools": [
      "unrestricted_exec",
      "sudo",
      "system_shell"
    ]
  },
  
  "rbac": {
    "description": "Role-based access control for users",
    "roles": {
      "anonymous": {
        "allowed_tools": ["search", "calculator", "weather"],
        "rate_limit": 100,
        "max_tokens": 1000
      },
      "user": {
        "allowed_tools": ["search", "calculator", "summarize", "translate", "weather", "calendar_view"],
        "rate_limit": 500,
        "max_tokens": 2000
      },
      "premium": {
        "allowed_tools": ["search", "calculator", "summarize", "translate", "weather", "calendar_view"],
        "rate_limit": 2000,
        "max_tokens": 4000
      },
      "admin": {
        "allowed_tools": ["*"],
        "rate_limit": 10000,
        "max_tokens": 8000
      }
    }
  },
  
  "output_filters": {
    "description": "Filters applied to LLM outputs",
    "pii_detection": {
      "enabled": true,
      "types": [
        "email",
        "phone",
        "ssn",
        "credit_card",
        "passport",
        "ip_address"
      ],
      "action": "redact"
    },
    "secret_detection": {
      "enabled": true,
      "patterns": [
        "AKIA[0-9A-Z]{16}",
        "-----BEGIN (RSA |)PRIVATE KEY-----",
        "[a-zA-Z0-9]{32,}\\.(us|eu)-[a-z]+-[0-9]\\.amazonaws\\.com"
      ],
      "action": "block"
    },
    "code_injection": {
      "enabled": true,
      "check_for": ["<script>", "javascript:", "eval(", "exec("],
      "action": "sanitize"
    }
  },
  
  "monitoring": {
    "log_all_requests": true,
    "log_blocked_requests": true,
    "log_pii": false,
    "retention_days": 90,
    "alert_on_patterns": [
      {
        "pattern": "blocked_requests > 50 in 5 minutes",
        "severity": "high",
        "notification": ["email", "slack"]
      },
      {
        "pattern": "risk_score > 90",
        "severity": "critical",
        "notification": ["email", "slack", "pagerduty"]
      }
    ]
  },
  
  "rate_limiting": {
    "by_ip": {
      "window_seconds": 300,
      "max_requests": 100
    },
    "by_user": {
      "window_seconds": 300,
      "max_requests": 500
    },
    "by_session": {
      "window_seconds": 60,
      "max_requests": 20
    }
  },
  
  "content_safety": {
    "toxicity_threshold": 0.5,
    "hate_speech_threshold": 0.7,
    "violence_threshold": 0.6,
    "sexual_content_threshold": 0.8,
    "action": "block"
  }
}
